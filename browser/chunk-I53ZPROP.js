import{e as p}from"./chunk-BAG2IDU5.js";import{a as h}from"./chunk-YFPKJNUV.js";import{J as n,M as l,R as u,Wb as c,i as s,m as i,x as o}from"./chunk-GXRW5RWN.js";var g=class a{constructor(t,e){this.http=t;this.router=e}API_URL=`${h.apiUrl}/api/auth`;TOKEN_EXPIRY_TIME=60*60*1e3;isAuthenticatedSubject=new s(this.hasToken());userDataSubject=new s(this.getUserData());isAuthenticated$=this.isAuthenticatedSubject.asObservable();userData$=this.userDataSubject.asObservable();register(t){return this.http.post(`${this.API_URL}/register`,t).pipe(n(e=>{this.storeAuthData(e)}),o(e=>{let r="Registration failed";return e.error==="Error: Email address is already taken!"?r="Email address is already taken":e.error&&typeof e.error=="object"&&(r=Object.values(e.error).join(", ")),i(()=>new Error(r))}))}login(t){return this.http.post(`${this.API_URL}/login`,t).pipe(n(e=>{this.storeAuthData(e)}),o(e=>{let r="Login failed";return e.status===401&&(r="Invalid email or password"),i(()=>new Error(r))}))}logout(){localStorage.removeItem("accessToken"),localStorage.removeItem("userData"),this.isAuthenticatedSubject.next(!1),this.userDataSubject.next(null),this.router.navigate(["/auth/login"])}getToken(){return localStorage.getItem("accessToken")}getUserData(){let t=localStorage.getItem("userData");if(!t)return null;try{let e=JSON.parse(t);return e.tokenExpiry<Date.now()?(this.logout(),null):e}catch{return this.logout(),null}}isAdmin(){return!!this.getUserData()?.roles.includes("ROLE_ADMIN")}isApplicant(){return!!this.getUserData()?.roles.includes("ROLE_APPLICANT")}hasToken(){return!!this.getToken()&&!!this.getUserData()}storeAuthData(t){localStorage.setItem("accessToken",t.accessToken);let e={userId:t.userId,email:t.email,roles:t.roles,tokenExpiry:Date.now()+this.TOKEN_EXPIRY_TIME};localStorage.setItem("userData",JSON.stringify(e)),this.isAuthenticatedSubject.next(!0),this.userDataSubject.next(e)}static \u0275fac=function(e){return new(e||a)(u(c),u(p))};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
